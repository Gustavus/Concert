{% spaceless %}
<script>
Modernizr.load({
  load: Gustavus.baseSrc,
  complete: function() {
    $(function() {
      var $messages         = $('#concertMessages');
      var $concertMenuItems = $('#concertMenuItems');
      var $concertMenuBar   = $('#concertMenuBar');

      // add messages in
      $messages.html(decodeURIComponent("{{ messages|url_encode }}"));

      var concertMenuBarWidth = $concertMenuBar.outerWidth() + $concertMenuBar.offset().left;

      var widthLeftOver = $concertMenuItems.outerWidth() - (concertMenuBarWidth + $messages.outerWidth());
      if (widthLeftOver < 0) {
        // messages are too wide
        $messages.width($messages.width() + widthLeftOver);
      } else {
        // center the messages
        var messagesFromRight = $concertMenuItems.outerWidth() - $messages.outerWidth() - concertMenuBarWidth;
        var diff = messagesFromRight - concertMenuBarWidth;
        if (diff > 0) {
          // we need to shift to the right
          $messages.css('margin-left', diff / 2);
        }
      }

      // make sure the height is high enough
      if ($messages.outerHeight() > $concertMenuItems.height()) {
        $concertMenuItems.animate({'height': $messages.outerHeight() + 'px'}, 1, 'swing', function() {
          setTimeout(function() {
            $messages.css('display', 'inline-block')
              .animate({'opacity': '1'}, 1);
          });
        });
      } else {
        $messages.css('display', 'inline-block')
          .animate({'opacity': '1'}, 1);
      }

    });
  }
});
</script>
{% endspaceless %}